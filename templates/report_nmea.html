<!doctype html>
<html>
<head>
<link rel="icon" type="image/png" href="/static/favicon.png">
  <meta charset="utf-8">
  <title>NMEA Analysis Report</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{
    --bg1:#0f1226;
    --bg2:#11163a;
    --card:#151a44;
    --muted:#9bb2ff;
    --text:#e8eeff;
    --accent:#6ea8ff;
    --accent2:#9d7bff;
    --border:#26306b;
    --shadow: 0 10px 40px rgba(0,0,0,.35), 0 0 80px rgba(110,168,255,.15);
    }
    *{ box-sizing:border-box; }
    body{
    margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--text);
    background:
    radial-gradient(1200px 800px at 20% -10%, #2b377d55, transparent 60%),
    radial-gradient(1200px 800px at 120% 120%, #7b4cff33, transparent 60%),
    linear-gradient(160deg, var(--bg1), var(--bg2));
    padding: 20px;
    }
    .wrap { width:min(1000px, 92vw); }
    
    header{
    display:flex; align-items:center; justify-content:space-between; margin-bottom:20px;
    }
    .brand{
    font-weight:800; font-size:24px; 
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .btn-home {
      text-decoration: none; color: var(--muted); border: 1px solid var(--border);
      padding: 6px 12px; border-radius: 8px; font-size: 14px; transition: .2s;
    }
    .btn-home:hover { background: #ffffff11; color: #fff; }

    .card{
    background: linear-gradient(180deg, rgba(21,26,68,.9), rgba(16,20,50,.9));
    border:1px solid var(--border); border-radius:18px; padding:24px;
    box-shadow: var(--shadow);
    margin-bottom: 20px;
    }

    h2 { margin-top: 0; font-size: 20px; color: #cfe0ff; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
    
    .stats-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; margin-bottom: 20px;
    }
    .stat-box {
      background: #0f1434aa; border: 1px solid var(--border); border-radius: 12px; padding: 15px; text-align: center;
    }
    .stat-label { font-size: 13px; color: var(--muted); margin-bottom: 5px; }
    .stat-value { font-size: 24px; font-weight: 700; color: #fff; }
    .stat-unit { font-size: 12px; color: var(--muted); }

    .chart-container {
      position: relative; height: 400px; width: 100%;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">NMEA Analysis Report</div>
      <a href="/" class="btn-home">‚Üê Back to Home</a>
    </header>

    {% if result.status == 'error' %}
    <div class="card" style="text-align:center; color:#ff6b6b;">
      <h3>Analysis Failed</h3>
      <p>{{ result.message }}</p>
    </div>
    {% else %}
    
    <!-- Statistics Section -->
    <div class="card">
      <h2>Statistics Summary</h2>
      <div class="stats-grid">
        <div class="stat-box">
          <div class="stat-label">Total Points</div>
          <div class="stat-value">{{ result.statistics.count }}</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Average Error</div>
          <div class="stat-value">{{ result.statistics.avg_error }}</div>
          <span class="stat-unit">meters</span>
        </div>
        <div class="stat-box">
          <div class="stat-label">Max Error</div>
          <div class="stat-value">{{ result.statistics.max_error }}</div>
          <span class="stat-unit">meters</span>
        </div>
        <div class="stat-box">
          <div class="stat-label">CEP 50%</div>
          <div class="stat-value">{{ result.statistics.cep_50 }}</div>
          <span class="stat-unit">meters</span>
        </div>
        <div class="stat-box">
          <div class="stat-label">CEP 95%</div>
          <div class="stat-value">{{ result.statistics.cep_95 }}</div>
          <span class="stat-unit">meters</span>
        </div>
      </div>
    </div>

    <!-- Chart Section -->
    <div class="card">
      <h2>Position Error over Time</h2>
      <div class="chart-container">
        <canvas id="errorChart"></canvas>
      </div>
    </div>

    <script>
      const ctx = document.getElementById('errorChart').getContext('2d');
      const graphData = {{ result.graph_data | tojson }};
      
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: graphData.labels,
          datasets: [{
            label: 'Position Error (m)',
            data: graphData.values,
            borderColor: '#6ea8ff',
            backgroundColor: 'rgba(110, 168, 255, 0.1)',
            borderWidth: 2,
            pointRadius: 0, // Hide points for cleaner look on large datasets
            pointHoverRadius: 4,
            tension: 0.1,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: 'index',
            intersect: false,
          },
          plugins: {
            legend: { labels: { color: '#9bb2ff' } },
            tooltip: {
              mode: 'index',
              intersect: false,
              backgroundColor: 'rgba(15, 18, 38, 0.9)',
              titleColor: '#fff',
              bodyColor: '#cfe0ff',
              borderColor: '#26306b',
              borderWidth: 1
            }
          },
          scales: {
            x: {
              ticks: { color: '#9bb2ff', maxTicksLimit: 10 },
              grid: { color: '#26306b' }
            },
            y: {
              beginAtZero: true,
              ticks: { color: '#9bb2ff' },
              grid: { color: '#26306b' },
              title: { display: true, text: 'Error (meters)', color: '#9bb2ff' }
            }
          }
        }
      });
    </script>
    {% endif %}
  </div>
</body>
</html>